<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <title>Pygame Library</title>
        <meta name="viewport" content="width=device-width, height=device-height initial-scale=1, shrink-to-fit=no">
        <link rel="shortcut icon" href="#">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css">

    </head>

    <body>

        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>
        <script defer src="https://use.fontawesome.com/releases/v5.7.2/js/all.js"></script>

        {% load static%}
        <link rel="stylesheet" href="{% static 'css/style.css/' %}">


        <div id="loading">
            <div class = "loading_image">
            <img src="{% static "images/loading_winter.gif"%}" width="5%" height="5%">
            <p>&nbsp;Loading...</p>
            </div>
        </div>

       
        <div class="title">
            <script src="https://cdnjs.cloudflare.com/ajax/libs/JQuery-Snowfall/1.7.4/snowfall.jquery.min.js"></script>
            <script>


                $.loading = function(){                        
                    window.addEventListener("load",function() {
                        setTimeout(function(){
                            $('#loading').hide();
                            const div = document.querySelector('body')
                            div.animate([{opacity: '0'}, {opacity: '1'}], 2500)
                            //loading画面hide , fade in効果
                            $(document).ready(function(){
                                $(document).snowfall({
                                    deviceorientation : true, 
                                    image: "../../static/images/flake.png",
                                    minSize: 1, 
                                    maxSize:20,
                                    maxSpeed : 5,
                                    flakeCount : 50
                                })
                            })
                            localStorage.setItem("loading", "check");
                        },3000)
                    })
                }
                
                if(!localStorage.getItem("loading")){
                    $.loading();
                // 1度だけ実行する処理内容
                }
                else{
                    $('#loading').hide();
                    $(document).ready(function(){
                        $(document).snowfall({
                            deviceorientation : true, 
                            image: "../../static/images/flake.png",
                            minSize: 1, 
                            maxSize:20,
                            maxSpeed : 5,
                            flakeCount : 50
                        });
                    });
                // 1度実行された後の処理内容
                }
            </script>

            <div class="login">
                <span class = "login d-flex align-items-center justify-content-center">
                    {% include 'login.html'%}  
                </span>
            </div>

            <div class="login-form-errors text-center">
                {% include "layouts/form_errors.html"%}
            </div>

            <script>

                $('.login').hide();

                loginShowTimer = 0;
                
                $.loginShow = function(){
                    $(document).one('click',(function() {
                        $('.login').show();
                        const div = document.querySelector('.login')
                        div.animate([{opacity: '0'}, {opacity: '1'}], 1000)
                        localStorage.setItem("loginShow", "check");
                    }))
                }

                if(!localStorage.getItem("loading")){
                    setTimeout(function(){                        
                        if(!localStorage.getItem("loginShow") && localStorage.getItem("loading")){
                            $.loginShow();
                        }
                    },3100)
                }else if(localStorage.getItem("loginShow")){
                    $('.login').show();
                }else{
                    $.loginShow();
                }

            </script>

            {% include 'layouts/footer.html' %}

        </div>
    </body>
</html>